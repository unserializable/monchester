# With various gcc and clang versions, perform:
#   - debug build
#   - release build

name: gcc+clang@linux+win+mac
on:
  push:
    branches: 'gh-action-qs'

defaults:
  run:
    # 4.3.48(1)/4.4.20(1)/5.0.17(1) for Ubuntu 16/18/20.04
    # 3.2.57(1) for macOS 10.15
    # 4.4.23(1) for Win 2016/2019
    shell: bash

jobs:
  build:
    strategy:
      fail-fast: false # Disabled to get full overview of build matrix statuses.
      # GH actions' concurrency for macOS jobs is limited to 5 at the free/open-source tier.
      # Regardless of tiers', a maximum of 256 jobs per workflow can be generated from matrix.
      # https://docs.github.com/en/actions/reference/usage-limits-billing-and-administration

      # HW specs for Win/Linux hosted runners: 2-core CPU, 7 GB RAM, 14 GB SSD disk
      # HW specs for macOS hosted runners: 3-core CPU, 14 GB RAM, 14 GB SSD disk
      # https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners
      max-parallel: 5
      matrix:
        os: [ 'ubuntu-16.04', 'ubuntu-18.04', 'ubuntu-20.04', 'macos-10.15', 'windows-2016' ]
        compiler: [ 'gcc', 'clang' ]
        build: [ 'monchester', 'release' ]
        # macOS 10.15 symlinks 'gcc' to clang, but has aliases to gcc-(8|9|10) available.
        exclude:
          - os: 'macos-10.15'
            compiler: 'gcc'
        include:
          - os: 'macos-10.15'
            compiler: 'gcc-8'
            build: 'monchester'
          - os: 'macos-10.15'
            compiler: 'gcc-8'
            build: 'release'
#          - os: 'macos-10.15'
#            compiler: 'gcc-9'
#          - os: 'macos-10.15'
#            compiler: 'gcc-10'
    name: ${{ matrix.compiler }} ${{ matrix.build }} build (${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v2
        with:
          ref: '1.0-branch'
      - name: make clean ${{ matrix.build }}
        env:
          CC: ${{ matrix.compiler }}
        run: make clean ${{ matrix.build }} && ./monchester --version
